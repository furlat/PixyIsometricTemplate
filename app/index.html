<!doctype html>
<html lang="en" data-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pixy Phase 3B - Geometry System</title>
    <link rel="stylesheet" href="/src/styles/main.css" />
  </head>
  <body>
    <canvas id="gameCanvas"></canvas>
    
    <!-- UI Control Bar (Simplified for Phase 3A) -->
    <div id="ui-control-bar" class="fixed top-4 left-1/2 transform -translate-x-1/2 bg-base-100/95 backdrop-blur-md border border-base-300 rounded-full shadow-lg z-50 px-4 py-2">
      <div class="flex items-center gap-3">
        <span class="text-sm font-semibold text-primary">Phase 3B Geometry</span>
        <div class="divider divider-horizontal mx-0"></div>
        <button id="toggle-geometry-panel" class="btn btn-sm btn-outline rounded-full">
          <span class="button-text">Geometry</span>
        </button>
        <button id="toggle-layers" class="btn btn-sm btn-outline rounded-full">
          <span class="button-text">Layers</span>
        </button>
        <button id="toggle-store-panel" class="btn btn-sm btn-primary rounded-full">
          <span class="button-text">Store</span>
        </button>
      </div>
    </div>
    
    <!-- Store Panel (Core Foundation Only) -->
    <div id="store-panel" class="fixed top-4 right-4 w-80 max-h-[calc(100vh-5rem)] bg-base-100/95 backdrop-blur-md border border-base-300 rounded-xl shadow-2xl z-50 overflow-hidden animate-fade-in">
      <!-- Header -->
      <div class="bg-base-200/50 border-b border-base-300 p-4 flex justify-between items-center">
        <h2 class="text-lg font-bold text-primary flex items-center gap-2">
          <span class="text-info">🎨</span>
          Phase 3B Geometry
        </h2>
        <button class="btn btn-sm btn-ghost btn-circle hover:bg-error hover:text-white transition-colors" id="close-store-panel" title="Close Store Panel">
          <span class="text-lg">✕</span>
        </button>
      </div>
      
      <!-- Scrollable Content -->
      <div class="max-h-[calc(100vh-11rem)] overflow-y-auto custom-scrollbar p-2">
        
        <!-- Phase 3A Status -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-success flex items-center gap-2">
              <span class="text-xs">▸</span>
              Phase 3B Status
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Game Initialized:</span>
                <span id="game-initialized" class="font-bold font-mono status-inactive">false</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Mesh Scale:</span>
                <span id="mesh-scale" class="font-bold font-mono status-active">1</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Layers Active:</span>
                <span id="layers-active" class="font-bold font-mono status-active">3</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Mouse Position -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-accent flex items-center gap-2">
              <span class="text-xs">▸</span>
              Mouse Position
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Vertex:</span>
                <span id="mouse-vertex" class="font-bold font-mono status-mouse">0, 0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Screen:</span>
                <span id="mouse-screen" class="font-bold font-mono status-mouse">0, 0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">World:</span>
                <span id="mouse-world" class="font-bold font-mono status-mouse">0, 0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-warning flex items-center gap-2">
              <span class="text-xs">▸</span>
              Navigation
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Offset:</span>
                <span id="navigation-offset" class="font-bold font-mono status-camera">0, 0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Is Dragging:</span>
                <span id="navigation-dragging" class="font-bold font-mono status-inactive">false</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Move Amount:</span>
                <span id="navigation-move-amount" class="font-bold font-mono text-primary">1</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Mesh System -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-info flex items-center gap-2">
              <span class="text-xs">▸</span>
              Mesh System
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Mesh Ready:</span>
                <span id="mesh-ready" class="font-bold font-mono status-inactive">false</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Cell Size:</span>
                <span id="mesh-cell-size" class="font-bold font-mono text-primary">20</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Dimensions:</span>
                <span id="mesh-dimensions" class="font-bold font-mono text-primary">0x0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Vertex Count:</span>
                <span id="mesh-vertex-count" class="font-bold font-mono text-primary">0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Needs Update:</span>
                <span id="mesh-needs-update" class="font-bold font-mono status-inactive">false</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Layer Controls -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-secondary flex items-center gap-2">
              <span class="text-xs">▸</span>
              Layer Controls
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Grid Layer:</span>
                <span id="layer-grid-status" class="font-bold font-mono status-active">ON</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Geometry Layer:</span>
                <span id="layer-geometry-status" class="font-bold font-mono status-active">ON</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Mouse Layer:</span>
                <span id="layer-mouse-status" class="font-bold font-mono status-active">ON</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Checkboard:</span>
                <span id="checkboard-enabled" class="font-bold font-mono status-inactive">OFF</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Mouse Highlight -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-accent flex items-center gap-2">
              <span class="text-xs">▸</span>
              Mouse Highlight
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Color:</span>
                <span id="mouse-highlight-color" class="font-bold font-mono text-primary">#ff0000</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Intensity:</span>
                <span id="mouse-highlight-intensity" class="font-bold font-mono text-primary">0.80</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Geometry System -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-success flex items-center gap-2">
              <span class="text-xs">▸</span>
              Geometry System
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Objects Count:</span>
                <span id="geometry-objects-count" class="font-bold font-mono text-primary">0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Drawing Mode:</span>
                <span id="geometry-drawing-mode" class="font-bold font-mono text-success">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Is Drawing:</span>
                <span id="geometry-is-drawing" class="font-bold font-mono status-inactive">false</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Preview Active:</span>
                <span id="geometry-preview-active" class="font-bold font-mono status-inactive">false</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Selected Object Testing (Phase 3B) -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-warning flex items-center gap-2">
              <span class="text-xs">▸</span>
              Selected Object (Testing)
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Object ID:</span>
                <span id="selected-object-id" class="font-bold font-mono text-muted">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Type:</span>
                <span id="selected-object-type" class="font-bold font-mono text-muted">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Pixeloid X:</span>
                <span id="selected-object-pixeloid-x" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Pixeloid Y:</span>
                <span id="selected-object-pixeloid-y" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Vertex X:</span>
                <span id="selected-object-vertex-x" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Vertex Y:</span>
                <span id="selected-object-vertex-y" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Screen X:</span>
                <span id="selected-object-screen-x" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Screen Y:</span>
                <span id="selected-object-screen-y" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Color:</span>
                <span id="selected-object-style-color" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Stroke Width:</span>
                <span id="selected-object-style-stroke-width" class="font-bold font-mono text-muted">-</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Is Dragging:</span>
                <span id="selected-object-dragging-state" class="font-bold font-mono status-inactive">false</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Drag State Testing (Phase 3B) -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-error flex items-center gap-2">
              <span class="text-xs">▸</span>
              Drag State (Testing)
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Is Dragging:</span>
                <span id="drag-state-is-dragging" class="font-bold font-mono status-inactive">false</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Object ID:</span>
                <span id="drag-state-object-id" class="font-bold font-mono text-muted">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Click Position:</span>
                <span id="drag-state-click-position" class="font-bold font-mono text-muted">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Vertex Offsets:</span>
                <span id="drag-state-vertex-offsets-count" class="font-bold font-mono text-muted">0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Preview Active:</span>
                <span id="drag-preview-is-active" class="font-bold font-mono status-inactive">false</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Preview Mouse:</span>
                <span id="drag-preview-mouse-position" class="font-bold font-mono text-muted">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Preview Vertices:</span>
                <span id="drag-preview-vertices-count" class="font-bold font-mono text-muted">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Phase 3B Controls -->
        <div class="alert alert-info bg-info/10 border-info/20">
          <div class="w-full">
            <h4 class="font-bold text-sm text-info mb-2 flex items-center gap-2">
              <span>⌨️</span>
              Phase 3B Controls
            </h4>
            <div class="space-y-1 text-xs text-base-content/80">
              <div class="flex items-center gap-2">
                <kbd class="kbd kbd-xs bg-base-300">W</kbd>
                <kbd class="kbd kbd-xs bg-base-300">A</kbd>
                <kbd class="kbd kbd-xs bg-base-300">S</kbd>
                <kbd class="kbd kbd-xs bg-base-300">D</kbd>
                <span>Move navigation offset</span>
              </div>
              <div class="flex items-center gap-2">
                <kbd class="kbd kbd-xs bg-base-300">F1</kbd>
                <span>Toggle store panel</span>
              </div>
              <div class="flex items-center gap-2">
                <kbd class="kbd kbd-xs bg-base-300">F2</kbd>
                <span>Toggle layer controls</span>
              </div>
              <div class="flex items-center gap-2">
                <kbd class="kbd kbd-xs bg-base-300">Space</kbd>
                <span>Center navigation offset</span>
              </div>
              <div class="flex items-center gap-2">
                <kbd class="kbd kbd-xs bg-base-300">Click</kbd>
                <span>Create geometry objects</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Debug Info -->
        <div class="card bg-base-200/30 shadow-sm">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-error flex items-center gap-2">
              <span class="text-xs">▸</span>
              Debug Info
            </h3>
            <div class="space-y-1 text-xs text-base-content/60">
              <div>Phase 3B Geometry - 3 Layer System</div>
              <div>Single mesh at scale 1 (pixel-perfect)</div>
              <div>Grid layer: checkboard pattern</div>
              <div>Geometry layer: drawable objects</div>
              <div>Mouse layer: highlight at cursor</div>
              <div>WASD navigation with store updates</div>
              <div>Click to create geometry objects</div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Geometry Panel (Essential Elements Only) -->
    <div id="geometry-panel" class="fixed top-4 left-4 w-80 max-h-[calc(100vh-2rem)] bg-base-100/95 backdrop-blur-md border border-base-300 rounded-xl shadow-2xl z-50 overflow-hidden animate-fade-in" style="display: none;">
      <!-- Header -->
      <div class="bg-base-200/50 border-b border-base-300 p-4 flex justify-between items-center">
        <h2 class="text-lg font-bold text-secondary flex items-center gap-2">
          <span class="text-success">🎨</span>
          Geometry Tools
        </h2>
        <button class="btn btn-sm btn-ghost btn-circle hover:bg-error hover:text-white transition-colors" id="close-geometry-panel" title="Close Geometry Panel">
          <span class="text-lg">✕</span>
        </button>
      </div>
      
      <!-- Scrollable Content -->
      <div class="max-h-[calc(100vh-8rem)] overflow-y-auto custom-scrollbar p-2">
        
        <!-- Drawing Modes -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-success flex items-center gap-2">
              <span class="text-xs">▸</span>
              Drawing Modes
            </h3>
            <div class="grid grid-cols-2 gap-2">
              <button id="geometry-mode-none" class="btn btn-xs btn-outline">None</button>
              <button id="geometry-mode-point" class="btn btn-xs btn-outline">Point</button>
              <button id="geometry-mode-line" class="btn btn-xs btn-outline">Line</button>
              <button id="geometry-mode-circle" class="btn btn-xs btn-outline">Circle</button>
              <button id="geometry-mode-rectangle" class="btn btn-xs btn-outline">Rectangle</button>
              <button id="geometry-mode-diamond" class="btn btn-xs btn-outline">Diamond</button>
            </div>
          </div>
        </div>

        <!-- Current State -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-primary flex items-center gap-2">
              <span class="text-xs">▸</span>
              Current State
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Mode:</span>
                <span id="geometry-current-mode" class="font-bold font-mono text-success">none</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Objects:</span>
                <span id="geometry-objects-count" class="font-bold font-mono text-primary">0</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Selected:</span>
                <span id="geometry-selected-count" class="font-bold font-mono text-info">0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Drawing Settings -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-accent flex items-center gap-2">
              <span class="text-xs">▸</span>
              Drawing Settings
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Stroke Color:</span>
                <input id="geometry-default-color" type="color" value="#0066cc" class="w-8 h-8 border border-base-300 rounded cursor-pointer" />
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Stroke Width:</span>
                <input id="geometry-default-stroke-width" type="number" step="0.5" min="0.5" value="2" class="input input-bordered input-xs w-20 text-center font-mono" />
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Fill Color:</span>
                <input id="geometry-default-fill-color" type="color" value="#99ccff" class="w-8 h-8 border border-base-300 rounded cursor-pointer" />
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Fill Enabled:</span>
                <input id="geometry-fill-enabled" type="checkbox" class="toggle toggle-accent toggle-xs" />
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Fill Alpha:</span>
                <input id="geometry-fill-alpha" type="range" min="0" max="1" step="0.1" value="0.5" class="range range-xs range-accent w-20" />
                <span id="geometry-fill-alpha-value" class="text-xs text-base-content/70">0.5</span>
              </div>
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Stroke Alpha:</span>
                <input id="geometry-stroke-alpha" type="range" min="0" max="1" step="0.1" value="1.0" class="range range-xs range-accent w-20" />
                <span id="geometry-stroke-alpha-value" class="text-xs text-base-content/70">1.0</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Drawing Options -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-warning flex items-center gap-2">
              <span class="text-xs">▸</span>
              Drawing Options
            </h3>
            <div class="space-y-2">
              <div class="flex justify-between items-center text-xs">
                <span class="text-base-content/70">Preview Opacity:</span>
                <input id="drawing-preview-opacity" type="range" min="0.1" max="1" step="0.1" value="0.7" class="range range-xs range-warning w-20" />
                <span id="drawing-preview-opacity-value" class="text-xs text-base-content/70">0.7</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="card bg-base-200/30 shadow-sm mb-3">
          <div class="card-body p-3">
            <h3 class="card-title text-sm text-error flex items-center gap-2">
              <span class="text-xs">▸</span>
              Actions
            </h3>
            <div class="space-y-2">
              <button id="geometry-clear-all" class="btn btn-sm btn-error w-full">
                Clear All Objects
              </button>
              <button id="geometry-reset-styles" class="btn btn-sm btn-warning w-full">
                Reset All Styles
              </button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- Layer Toggle Bar (Grid + Mouse + Checkboard) -->
    <div id="layer-toggle-bar" class="fixed bottom-4 right-4 bg-base-100/95 backdrop-blur-md border border-base-300 rounded-full shadow-lg z-50 px-4 py-2">
      <div class="flex items-center gap-2">
        <span class="text-sm font-semibold text-accent">Layers</span>
        <div class="divider divider-horizontal mx-0"></div>
        <button id="toggle-layer-mouse" class="btn btn-sm btn-accent rounded-full">
          <span class="button-text">Mouse</span>
        </button>
        <button id="toggle-geometry" class="btn btn-sm btn-success rounded-full">
          <span class="button-text">Geometry</span>
        </button>
        <button id="toggle-checkboard" class="btn btn-sm btn-outline rounded-full">
          <span class="button-text">Checkboard</span>
        </button>
      </div>
    </div>

    <!-- Object Edit Panel (Phase 3B) -->
    <div id="object-edit-panel" class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-96 max-h-[calc(100vh-4rem)] bg-base-100/95 backdrop-blur-md border border-base-300 rounded-xl shadow-2xl z-50 overflow-hidden animate-fade-in" style="display: none;">
      <!-- Header -->
      <div class="bg-base-200/50 border-b border-base-300 p-4 flex justify-between items-center">
        <h2 class="text-lg font-bold text-primary flex items-center gap-2">
          <span class="text-warning">📝</span>
          Edit Object
        </h2>
        <div class="flex gap-2">
          <button class="btn btn-sm btn-success" id="edit-panel-apply" title="Apply Changes">
            Apply
          </button>
          <button class="btn btn-sm btn-warning" id="edit-panel-cancel" title="Cancel Changes">
            Cancel
          </button>
          <button class="btn btn-sm btn-ghost btn-circle hover:bg-error hover:text-white transition-colors" id="edit-panel-close" title="Close Panel">
            <span class="text-lg">✕</span>
          </button>
        </div>
      </div>
      
      <!-- Dynamic Content Container -->
      <div id="object-edit-panel-content" class="max-h-[calc(100vh-12rem)] overflow-y-auto custom-scrollbar p-4">
        <!-- Content will be dynamically generated by ObjectEditPanel_3b -->
      </div>
    </div>

    <script type="module" src="/src/main.ts"></script>
  </body>
</html>